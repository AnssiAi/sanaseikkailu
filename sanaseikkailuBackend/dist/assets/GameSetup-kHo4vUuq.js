import{a as M,b as G,r as n,j as t,U as et}from"./index-M_ThdXDG.js";const st=e=>{M.put(`${G}/users`,e).catch(s=>{throw new Error(s)})},W=e=>Math.floor(Math.random()*e),U=e=>{for(let s=e.length-1;s>0;s--){const c=Math.floor(Math.random()*(s+1)),d=e[s];e[s]=e[c],e[c]=d}return e},nt=e=>typeof e=="string"||e instanceof String,R=e=>{let s=!0;return(!nt(e)||e.length===0)&&(s=!1),s},b=1e3,ct=b*60,at=e=>{const s=Date.now()+e*b,[c,d]=n.useState(s-Date.now()),f=()=>{const h=s-Date.now();h<=0||d(h)};return n.useEffect(()=>{const h=setInterval(()=>f(),b);return()=>clearInterval(h)},[]),{total:c,seconds:Math.floor(c/b%60),minutes:Math.floor(c/ct%60)}},ot=()=>{const[e,s]=n.useState(0),[c,d]=n.useState(0);return{score:e,streak:c,resetStreak:()=>{d(0)},incStreak:()=>{d(u=>u+1)},incScore:()=>{s(u=>u+1+c)}}},q=({list:e,handleSelect:s})=>{const{word:c,matchKey:d,complete:f}=n.useContext(D),h=x=>{x.preventDefault,s(d,e)};return t.jsx("input",{className:"matchInput",type:"button",disabled:f,value:c,onClick:h})},$="/assets/coinPile-ocP87kNP.svg",B="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20width='100%25'%20height='100%25'%20viewBox='0%200%20200%20200'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20xml:space='preserve'%20xmlns:serif='http://www.serif.com/'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;'%3e%3crect%20id='Artboard1'%20x='0'%20y='0'%20width='200'%20height='200'%20style='fill:none;'/%3e%3cg%20id='Artboard11'%20serif:id='Artboard1'%3e%3cpath%20d='M25.413,127.306c0.141,-21.655%209.24,-48.327%2031.002,-68.448c30.081,-27.812%2020.994,-55.634%2020.994,-55.634c29.168,6.055%2056.32,29.837%2071.192,64.836c1.27,-6.826%201.619,-14.192%200.813,-21.843c-0,-0%2025.589,21.904%2025.17,80.904l-0.007,0.696c0,38.06%20-33.419,68.959%20-74.583,68.959c-41.163,0%20-74.583,-30.899%20-74.583,-68.959l0.002,-0.511Zm25.414,13.448c1.215,-34.625%2044.386,-70.538%2053.307,-70.41c-0,-0%20-10.192,15.655%2020.925,33.073c1.485,0.832%202.763,1.684%203.852,2.556c12.286,8.156%2020.277,21.369%2020.277,36.271c0,24.748%20-22.043,44.841%20-49.194,44.841c-27.15,0%20-49.194,-20.093%20-49.194,-44.841l0.027,-1.49Z'%20style='fill:%23ec6925;'/%3e%3c/g%3e%3c/svg%3e",D=n.createContext({word:"",matchKey:"",complete:!1}),rt=5,lt=({gameSettings:e,wordList:s})=>{const[c,d]=n.useState(!1),[f,h]=n.useState(""),[x,u]=n.useState(""),[y,C]=n.useState([]),[S,k]=n.useState([]),[j,i]=n.useState([]),[a,w]=n.useState([]),{user:K,setUser:Z}=n.useContext(et),{total:A,seconds:O,minutes:Y}=at(e.gameTime),{score:E,streak:F,resetStreak:z,incStreak:J,incScore:Q}=ot();n.useEffect(()=>{(()=>{let o=[],m=[];for(let v=0;v<rt;v++){const r=P();o=o.concat(r.host),m=m.concat(r.study)}C(U(o)),k(U(m)),d(!c)})()},[s]),n.useEffect(()=>{A<1e3&&tt()},[A]),n.useEffect(()=>{f.length!==0&&x.length!==0&&(f===x?X():_())},[f,x]),n.useEffect(()=>{if(j.length>0&&a.length>0){const l=setTimeout(()=>{const o=j[W(j.length)],m=a[W(a.length)],v=j.filter(g=>g.matchKey!==o.matchKey),r=a.filter(g=>g.matchKey!==m.matchKey),p=P(),N=y.map(g=>{let L=g;return g.matchKey===o.matchKey&&(L=p.host),L}),T=S.map(g=>{let L=g;return g.matchKey===m.matchKey&&(L=p.study),L});i(v),w(r),C(N),k(T)},2e3);return()=>clearTimeout(l)}},[j,a]);const P=()=>{const l=s.length;let o;for(;o===void 0;){const m=s[W(l)],v=(m[e.hostLanguage]+m[e.studyLanguage]).split(" ").join(""),r={word:m[e.hostLanguage],matchKey:v,complete:!1},p={word:m[e.studyLanguage],matchKey:v,complete:!1},N=y.find(g=>g.matchKey===r.matchKey),T=S.find(g=>g.matchKey===p.matchKey);!N&&!T&&(o={host:r,study:p})}return o},H=(l,o)=>{switch(o){case"host":h(l);break;case"study":u(l);break}},I=()=>{h(""),u("")},X=()=>{const l=y.find(r=>r.matchKey===f),o=S.find(r=>r.matchKey===x),m=y.map(r=>{let p=r;return r.matchKey===f&&(p={...r,complete:!0}),p}),v=S.map(r=>{let p=r;return r.matchKey===x&&(p={...r,complete:!0}),p});l&&o&&(i(j.concat(l)),w(a.concat(o))),C(m),k(v),J(),Q(),I()},_=()=>{z(),I()},tt=()=>{if(K){const l={...K,points:K.points+E};Z(l),st(l)}d(!c)};return t.jsx(t.Fragment,{children:t.jsx("div",{className:"matchGame",children:c?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"scoreCard",children:[t.jsxs("div",{className:"coinSpan",children:[t.jsx("img",{src:$,height:150,width:150}),t.jsx("div",{children:t.jsx("p",{children:E})})]}),t.jsxs("h2",{children:[("0"+Y).slice(-2),":",("0"+O).slice(-2)]}),t.jsxs("div",{className:"flameSpan",children:[t.jsx("img",{src:B,height:150,width:150}),t.jsx("div",{children:t.jsx("p",{children:F})})]})]}),t.jsx("div",{className:"hostList",children:y.map((l,o)=>t.jsx(D.Provider,{value:l,children:t.jsx(q,{list:"host",handleSelect:H})},o))}),t.jsx("div",{className:"studyList",children:S.map((l,o)=>t.jsx(D.Provider,{value:l,children:t.jsx(q,{list:"study",handleSelect:H})},o))})]}):t.jsx(t.Fragment,{children:t.jsxs("div",{className:"scoreCard",children:[t.jsxs("div",{className:"coinSpan",children:[t.jsx("img",{src:$,height:150,width:150}),t.jsx("div",{children:t.jsx("p",{children:E})})]}),t.jsx("h2",{children:"Peli loppu!"}),t.jsxs("div",{className:"flameSpan",children:[t.jsx("img",{src:B,height:150,width:150}),t.jsx("div",{children:t.jsx("p",{children:F})})]})]})})})})},it=()=>M.get(`${G}/col`).then(s=>s.data).catch(s=>{throw new Error(s)}),dt=e=>M.get(`${G}/${e}`).then(c=>c.data).catch(c=>{throw new Error(c)}),ht=120,V=await it(),mt=({game:e})=>{const[s,c]=n.useState([]),[d,f]=n.useState(V[0]),[h,x]=n.useState(!1),[u,y]=n.useState({hostLanguage:"fin",studyLanguage:"en",gameTime:ht});n.useEffect(()=>{(async()=>{try{const a=await dt(d);c(a)}catch(a){let w="Error: ";a instanceof Error&&(w+=a.message),console.log(w)}})()},[d]);const C=i=>{i.preventDefault();const a=R(u.hostLanguage),w=R(u.studyLanguage);a&&w?x(!h):alert("Valitse kaksi kieltÃ¤")},S=i=>{if(i.preventDefault(),i.target instanceof HTMLSelectElement){const a={...u,[i.target.name]:i.target.value};y(a)}},k=i=>{i.preventDefault,i.target instanceof HTMLInputElement&&f(i.target.value)},j=()=>{switch(e){case"matchGame":return t.jsx(lt,{gameSettings:u,wordList:s});default:return null}};return t.jsx(t.Fragment,{children:t.jsx("div",{className:"gameContainer",children:h?j():t.jsxs(t.Fragment,{children:[t.jsxs("fieldset",{className:"tagSet",children:[t.jsx("legend",{children:"Sanastot"}),V.map((i,a)=>t.jsxs("div",{className:"tagSelector",children:[t.jsx("input",{id:"tag"+a,type:"radio",name:"listSelect",value:i,onChange:k}),t.jsx("label",{className:"tagLabel",htmlFor:"tag"+a,children:i})]},a))]}),t.jsxs("form",{className:"setupForm",onSubmit:C,children:[t.jsxs("select",{name:"hostLanguage",onChange:S,value:u.hostLanguage,children:[t.jsx("option",{value:"fin",children:"Suomi"}),t.jsx("option",{value:"en",children:"Englanti"}),t.jsx("option",{value:"sve",children:"Ruotsi"})]}),t.jsxs("select",{name:"studyLanguage",onChange:S,value:u.studyLanguage,children:[t.jsx("option",{value:"fin",children:"Suomi"}),t.jsx("option",{value:"en",children:"Englanti"}),t.jsx("option",{value:"sve",children:"Ruotsi"})]}),t.jsx("button",{className:"submitBtn",type:"submit",children:"start game"})]})]})})})};export{mt as default};
