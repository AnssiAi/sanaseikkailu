import{a as F,b as G,r as n,j as t,U as _}from"./index-DKXqVJgA.js";const tt=e=>{F.put(`${G}/users`,e).catch(s=>{throw new Error(s)})},M=e=>Math.floor(Math.random()*e),U=e=>{for(let s=e.length-1;s>0;s--){const a=Math.floor(Math.random()*(s+1)),u=e[s];e[s]=e[a],e[a]=u}return e},et=e=>typeof e=="string"||e instanceof String,R=e=>{let s=!0;return(!et(e)||e.length===0)&&(s=!1),s},K=1e3,st=K*60,nt=e=>{const s=Date.now()+e*K,[a,u]=n.useState(s-Date.now()),f=()=>{const h=s-Date.now();h<=0||u(h)};return n.useEffect(()=>{const h=setInterval(()=>f(),K);return()=>clearInterval(h)},[]),{total:a,seconds:Math.floor(a/K%60),minutes:Math.floor(a/st%60)}},at=()=>{const[e,s]=n.useState(0),[a,u]=n.useState(0);return{score:e,streak:a,resetStreak:()=>{u(0)},incStreak:()=>{u(d=>d+1)},incScore:()=>{s(d=>d+1+a)}}},q=({list:e,handleSelect:s})=>{const{word:a,matchKey:u,complete:f}=n.useContext(T),h=S=>{S.preventDefault,s(u,e)};return t.jsx("input",{className:"matchInput",type:"button",disabled:f,value:a,onClick:h})},T=n.createContext({word:"",matchKey:"",complete:!1}),ct=5,ot=({gameSettings:e,wordList:s})=>{const[a,u]=n.useState(!1),[f,h]=n.useState(""),[S,d]=n.useState(""),[y,w]=n.useState([]),[j,k]=n.useState([]),[v,i]=n.useState([]),[c,C]=n.useState([]),{user:b,setUser:B}=n.useContext(_),{total:D,seconds:V,minutes:z}=nt(e.gameTime),{score:E,streak:H,resetStreak:J,incStreak:O,incScore:Q}=at();n.useEffect(()=>{(()=>{let o=[],m=[];for(let x=0;x<ct;x++){const r=A();o=o.concat(r.host),m=m.concat(r.study)}w(U(o)),k(U(m)),u(!a)})()},[s]),n.useEffect(()=>{D<1e3&&Z()},[D]),n.useEffect(()=>{f.length!==0&&S.length!==0&&(f===S?X():Y())},[f,S]),n.useEffect(()=>{if(v.length>0&&c.length>0){const l=setTimeout(()=>{const o=v[M(v.length)],m=c[M(c.length)],x=v.filter(g=>g.matchKey!==o.matchKey),r=c.filter(g=>g.matchKey!==m.matchKey),p=A(),N=y.map(g=>{let L=g;return g.matchKey===o.matchKey&&(L=p.host),L}),W=j.map(g=>{let L=g;return g.matchKey===m.matchKey&&(L=p.study),L});i(x),C(r),w(N),k(W)},2e3);return()=>clearTimeout(l)}},[v,c]);const A=()=>{const l=s.length;let o;for(;o===void 0;){const m=s[M(l)],x=(m[e.hostLanguage]+m[e.studyLanguage]).split(" ").join(""),r={word:m[e.hostLanguage],matchKey:x,complete:!1},p={word:m[e.studyLanguage],matchKey:x,complete:!1},N=y.find(g=>g.matchKey===r.matchKey),W=j.find(g=>g.matchKey===p.matchKey);!N&&!W&&(o={host:r,study:p})}return o},I=(l,o)=>{switch(o){case"host":h(l);break;case"study":d(l);break}},P=()=>{h(""),d("")},X=()=>{const l=y.find(r=>r.matchKey===f),o=j.find(r=>r.matchKey===S),m=y.map(r=>{let p=r;return r.matchKey===f&&(p={...r,complete:!0}),p}),x=j.map(r=>{let p=r;return r.matchKey===S&&(p={...r,complete:!0}),p});l&&o&&(i(v.concat(l)),C(c.concat(o))),w(m),k(x),O(),Q(),P()},Y=()=>{J(),P()},Z=()=>{if(b){const l={...b,points:b.points+E};B(l),tt(l)}u(!a)};return t.jsx(t.Fragment,{children:t.jsx("div",{className:"matchGame",children:a?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"scoreCard",children:[t.jsxs("div",{className:"coinSpan",children:[t.jsx("img",{src:"src\\assets\\icons\\coinPile.svg",height:150,width:150}),t.jsx("div",{children:t.jsx("p",{children:E})})]}),t.jsxs("h2",{children:[("0"+z).slice(-2),":",("0"+V).slice(-2)]}),t.jsxs("div",{className:"flameSpan",children:[t.jsx("img",{src:"src\\assets\\icons\\flame200.svg",height:150,width:150}),t.jsx("div",{children:t.jsx("p",{children:H})})]})]}),t.jsx("div",{className:"hostList",children:y.map((l,o)=>t.jsx(T.Provider,{value:l,children:t.jsx(q,{list:"host",handleSelect:I})},o))}),t.jsx("div",{className:"studyList",children:j.map((l,o)=>t.jsx(T.Provider,{value:l,children:t.jsx(q,{list:"study",handleSelect:I})},o))})]}):t.jsx(t.Fragment,{children:t.jsxs("div",{className:"scoreCard",children:[t.jsxs("div",{className:"coinSpan",children:[t.jsx("img",{src:"src\\assets\\icons\\coinPile.svg",height:150,width:150}),t.jsx("div",{children:t.jsx("p",{children:E})})]}),t.jsx("h2",{children:"Peli loppu!"}),t.jsxs("div",{className:"flameSpan",children:[t.jsx("img",{src:"src\\assets\\icons\\flame200.svg",height:150,width:150}),t.jsx("div",{children:t.jsx("p",{children:H})})]})]})})})})},rt=()=>F.get(`${G}/col`).then(s=>s.data).catch(s=>{throw new Error(s)}),lt=e=>F.get(`${G}/${e}`).then(a=>a.data).catch(a=>{throw new Error(a)}),it=120,$=await rt(),ht=({game:e})=>{const[s,a]=n.useState([]),[u,f]=n.useState($[0]),[h,S]=n.useState(!1),[d,y]=n.useState({hostLanguage:"fin",studyLanguage:"en",gameTime:it});n.useEffect(()=>{(async()=>{try{const c=await lt(u);a(c)}catch(c){let C="Error: ";c instanceof Error&&(C+=c.message),console.log(C)}})()},[u]);const w=i=>{i.preventDefault();const c=R(d.hostLanguage),C=R(d.studyLanguage);c&&C?S(!h):alert("Valitse kaksi kieltÃ¤")},j=i=>{if(i.preventDefault(),i.target instanceof HTMLSelectElement){const c={...d,[i.target.name]:i.target.value};y(c)}},k=i=>{i.preventDefault,i.target instanceof HTMLInputElement&&f(i.target.value)},v=()=>{switch(e){case"matchGame":return t.jsx(ot,{gameSettings:d,wordList:s});default:return null}};return t.jsx(t.Fragment,{children:t.jsx("div",{className:"gameContainer",children:h?v():t.jsxs(t.Fragment,{children:[t.jsxs("fieldset",{className:"tagSet",children:[t.jsx("legend",{children:"Sanastot"}),$.map((i,c)=>t.jsxs("div",{className:"tagSelector",children:[t.jsx("input",{id:"tag"+c,type:"radio",name:"listSelect",value:i,onChange:k}),t.jsx("label",{className:"tagLabel",htmlFor:"tag"+c,children:i})]},c))]}),t.jsxs("form",{className:"setupForm",onSubmit:w,children:[t.jsxs("select",{name:"hostLanguage",onChange:j,value:d.hostLanguage,children:[t.jsx("option",{value:"fin",children:"Suomi"}),t.jsx("option",{value:"en",children:"Englanti"}),t.jsx("option",{value:"sve",children:"Ruotsi"})]}),t.jsxs("select",{name:"studyLanguage",onChange:j,value:d.studyLanguage,children:[t.jsx("option",{value:"fin",children:"Suomi"}),t.jsx("option",{value:"en",children:"Englanti"}),t.jsx("option",{value:"sve",children:"Ruotsi"})]}),t.jsx("button",{className:"submitBtn",type:"submit",children:"start game"})]})]})})})};export{ht as default};
